<html>
<head>
	<title>Time Calculator</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
	<style>
		body {
			margin: 1em auto;
			max-width: 45em;
			font-family: sans-serif;
			line-height: 1.2;
			padding: 0.5em;
		}
		.allow-overflow {
			overflow-x: auto;
			-webkit-overflow-scrolling: touch;
		}
		table {
			white-space: nowrap;
		}
		input, button {
			font-size: inherit;
		}
		button {
			background-color: white;
			border: 1px solid black;
		}
	</style>
	<script type="text/javascript">
		function fillInCurrentItem(id) {
			document.getElementById(id).value = currentTime();
		}

		function fillInDate(id) {
			let date = new Date();
			date.setHours(date.getHours() - date.getTimezoneOffset() / 60);
			document.getElementById(id).value = date.toJSON().substring(0, 19);
		}

		function calculateDuration() {
			const first = new Date(document.getElementById('first').value);
			const second = new Date(document.getElementById('second').value);
			console.log
			const msDiff = second - first;
			let output = "";
			output += (msDiff / 1000) + " seconds</br>";
			output += (msDiff / 1000 / 60).toFixed(0) + " minutes</br>";
			output += (msDiff / 1000 / 60 / 60).toFixed(1) + " hours</br>";
			output += (msDiff / 1000 / 60 / 60 / 24).toFixed(1) + " days</br>";
			output += (msDiff / 1000 / 60 / 60 / 24 / 7).toFixed(0) + " weeks</br>";
			output += (msDiff / 1000 / 60 / 60 / 24 / 30).toFixed(1) + " months</br>";
			output += (msDiff / 1000 / 60 / 60 / 24 / 365).toFixed(1) + " years</br>";
			document.getElementById('duration').innerHTML = output;
		}

		function convertToMinutes(rawValue) {
			const raw = rawValue.split(':');
			const minutes = (parseInt(raw[0]) * 60) + parseInt(raw[1]);
			return minutes;
		}

		function calculateDiff() {
			const start = convertToMinutes(document.getElementById('start').value);
			let end = convertToMinutes(document.getElementById('end').value);
			while (start > end) {
				end += 1440;
			}
			const diffRaw = Math.abs(end - start);
			const decimalizedDiffRaw = (diffRaw / 60).toFixed(1);
			document.getElementById('difference').innerHTML = convertToFormat(diffRaw) + ' / ' + decimalizedDiffRaw;
		}

		function currentTime() {
			const date = new Date();
			const time = convertToMinutes(date.getHours() + ":" + date.getMinutes());
			return convertToFormat(time, true);
		}

		function convertToFormat(input, padding) {
			while (input < 0) {
				input += 1440;
			}
			let hours = Math.floor(input / 60);
			if (hours < 10 && padding) {
				hours = '0' + hours;
			}
			let minutes = (input % 60).toFixed(0);
			if (minutes < 10) {
				minutes = '0' + minutes;
			}
			return hours + ":" + minutes;
		}

		function calculateValue() {
			const initial = convertToMinutes(document.getElementById('initial').value);
			let rawValue = document.getElementById('value').value;
			let value;
			if (rawValue.includes(':')) {
				value = convertToMinutes(rawValue);
			} else {
				value = rawValue * 60;
			}
			if (document.getElementById('subtract').checked) {
				value = -value;
			}
			const result = (initial + value) % 1440;
			document.getElementById('valueDiff').value = convertToFormat(result, true);
		}

		function checkVersion() {
			const currentVersion = "0.0.1";
			if (localStorage.length === 0) {
				localStorage["version"] = currentVersion;
			} else {
				if (localStorage["version"] !== currentVersion) {
					localStorage.clear();
					console.log("Your settings were cleared.");
					localStorage.version = currentVersion;
				}
			}
		}

		function setDefault(tag) {
			localStorage[tag] = document.getElementById(tag).value;
			console.log(localStorage[tag]);
		}

		function resetSettings() {
			localStorage.clear();
		}
	</script>
</head>
<body>
<h1>Time Calculator</h1>

<hr>

<h2>Difference in Time</h2>
<div class="allow-overflow">
<table>
	<tr>
		<td>Start:</td>
		<td><input type="time" id="start"></td>
		<td><button type="button" onclick="fillInCurrentItem('start')">Now</button></td>
		<td><button type="button" onclick="setDefault('start')">Set Default</button></td>
	</tr>
	<tr>
		<td>End:</td>
		<td><input type="time" id="end"></td>
		<td><button type="button" onclick="fillInCurrentItem('end')">Now</button></td>
		<td><button type="button" onclick="setDefault('end')">Set Default</button></td>
	</tr>
	<tr>
		<td>Diff:</td>
		<td><div id="difference"></div></td>
		<td><button type="button" onclick="calculateDiff()">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<h2>Add/Subtract Value to Time</h2>
<p>Format all value inputs as either "[hours]:[minutes]" (such as 2:10, which represents 2 hours and 10 minutes) or "[hours]" (such as 2.5 or 5, which represents 2.5 hours and 5 hours, respectively).</p>
<div class="allow-overflow">
<table>
	<tr>
		<td>Initial:</td>
		<td><input type="time" id="initial"></td>
		<td><button type="button" onclick="fillInCurrentItem('initial')">Now</button></td>
		<td><button type="button" onclick="setDefault('initial')">Set Default</button></td>
	</tr>
	<tr>
		<td>Action:</td>
		<td><input type="radio" name="action" id="add" checked> Add</td>
	</tr>
	<tr>
		<td></td>
		<td><input type="radio" name="action" id="subtract"> Subtract</td>
	</tr>
	<tr>
		<td>Value:</td>
		<td><input id="value" value="0:00" size="5"></td>
	</tr>
	<tr>
		<td>Final:</td>
		<td><input type="time" id="valueDiff" disabled></td>
		<td><button type="button" onclick="calculateValue()">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<h2>Duration in Dates/Times</h2>
<p>
If you want to calculate the duration without the time component, fill in "12:00:00 AM" (it actually doesn't matter what the time is as long as the time in both fields are the same).
<p>

<div class="allow-overflow">
<table>
	<tr>
		<td>First:</td>
		<td><input type="datetime-local" id="first"></td>
		<td><button type="button" onclick="fillInDate('first')">Now</button></td>
	</tr>
	<tr>
		<td>Second:</td>
		<td><input type="datetime-local" id="second"></td>
		<td><button type="button" onclick="fillInDate('second')">Now</button></td>
	</tr>
	<tr>
		<td valign="top">Duration:</td>
		<td><div id="duration"></div></td>
		<td valign="top"><button type="button" onclick="calculateDuration()">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<p>
Not my finest work, but it does work. And it's ultra light-weight. As opposed to <a href="https://www.timeanddate.com/date/timeduration.html">this bloated mess</a> that requires POSTing a request and taking ~9 seconds to load a ~900 KB page on a ~200 Mbps connection.
</p>

<button type="button" onclick="resetSettings()">Reset All Settings</button>

<script>
	checkVersion();

	const elements = ["start", "end", "initial"];
	elements.forEach(item => {
		if (localStorage[item] === undefined) {
			document.getElementById(item).value = currentTime();
		} else {
			document.getElementById(item).value = localStorage[item];
		}
	})

	calculateDiff();
</script>
</body>
</html>
