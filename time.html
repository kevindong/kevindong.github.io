<html>
<head>
	<title>Time Calculator</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
	<style>
		body {
			margin: 1em auto;
			max-width: 45em;
			font-family: sans-serif;
			line-height: 1.2;
			padding: 0.5em;
		}
		.allow-overflow {
			overflow-x: auto;
			-webkit-overflow-scrolling: touch;
		}
		table {
			white-space: nowrap;
		}
		input, button {
			font-size: inherit;
		}
		button {
			background-color: white;
			border: 1px solid black;
		}
	</style>
	<script type="text/javascript">
		function currentTime() {
			const date = new Date();
			const time = convertToMinutes(date.getHours() + ":" + date.getMinutes());
			return convertToFormat(time, true);
		}
		
		function fillInCurrentItem(id) {
			document.getElementById(id).value = currentTime();
		}

		function fillInDate(id) {
			const now = new Date();
			now.setHours(now.getHours() - now.getTimezoneOffset() / 60);
			let date = "";
			date += now.getFullYear() + "-";
			if (((now.getMonth() + 1) % 13).toString().length == 1) {
				date += "0";
			}
			date += ((now.getMonth() + 1) % 13) + "-";
			date += now.getDate();
			document.getElementById(id).value = date;
		}
		
		function fillInDateTime(id) {
			let now = new Date();
			now.setHours(now.getHours() - now.getTimezoneOffset() / 60);
			document.getElementById(id).value = now.toJSON().substring(0, 19);
		}

		function calculateDuration(id) {
			const first = new Date(document.getElementById(id + '_start').value);
			const second = new Date(document.getElementById(id + '_end').value);
			const msDiff = second - first;
			let output = "";
			output += (msDiff / 1000).toFixed(0) + " seconds</br>";
			output += (msDiff / 1000 / 60).toFixed(0) + " minutes</br>";
			output += (msDiff / 1000 / 60 / 60).toFixed(1) + " hours</br>";
			output += (msDiff / 1000 / 60 / 60 / 24).toFixed(1) + " days</br>";
			output += (msDiff / 1000 / 60 / 60 / 24 / 7).toFixed(0) + " weeks</br>";
			output += (msDiff / 1000 / 60 / 60 / 24 / 30).toFixed(1) + " months</br>";
			output += (msDiff / 1000 / 60 / 60 / 24 / 365).toFixed(1) + " years</br>";
			document.getElementById(id + '_duration').innerHTML = output;
		}

		function convertToMinutes(rawValue) {
			const raw = rawValue.split(':');
			const minutes = (parseInt(raw[0]) * 60) + parseInt(raw[1]);
			return minutes;
		}

		function calculateDiff() {
			const start = convertToMinutes(document.getElementById('time_start').value);
			let end = convertToMinutes(document.getElementById('time_end').value);
			while (start > end) {
				end += 1440;
			}
			const diffRaw = Math.abs(end - start);
			const decimalizedDiffRaw = (diffRaw / 60).toFixed(1);
			document.getElementById('time_diff').innerHTML = convertToFormat(diffRaw) + ' / ' + decimalizedDiffRaw;
		}

		function convertToFormat(input, padding) {
			while (input < 0) {
				input += 1440;
			}
			let hours = Math.floor(input / 60);
			if (hours < 10 && padding) {
				hours = '0' + hours;
			}
			let minutes = (input % 60).toFixed(0);
			if (minutes < 10) {
				minutes = '0' + minutes;
			}
			return hours + ":" + minutes;
		}

		function calculateValue() {
			const initial = convertToMinutes(document.getElementById('time_value_initial').value);
			let rawValue = document.getElementById('time_value_value').value;
			let value;
			if (rawValue.includes(':')) {
				value = convertToMinutes(rawValue);
			} else {
				value = rawValue * 60;
			}
			if (document.getElementById('subtract').checked) {
				value = -value;
			}
			const result = (initial + value) % 1440;
			document.getElementById('time_value_valueDiff').value = convertToFormat(result, true);
		}

		function checkVersion() {
			const currentVersion = "March 20, 2017 at 2:03:45 AM ET";
			if (localStorage.length === 0) {
				localStorage["version"] = currentVersion;
			} else {
				if (localStorage["version"] !== currentVersion) {
					localStorage.clear();
					console.log("Your settings were cleared.");
					localStorage.version = currentVersion;
				}
			}
		}

		function setDefault(tag) {
			localStorage[tag] = document.getElementById(tag).value;
			console.log("Set tag \"" + tag + "\" to: " + localStorage[tag]);
		}

		function resetSettings() {
			localStorage.clear();
		}
	</script>
</head>
<body>
<h1>Time Calculator</h1>
This works best on most mobile browsers and desktop Google Chrome/Chromium (because of their built in date/time pickers).
<hr>

<h2>Difference in Time</h2>
<div class="allow-overflow">
<table>
	<tr>
		<td>Start:</td>
		<td><input type="time" id="time_start"></td>
		<td><button type="button" onclick="fillInCurrentItem('time_start')">Now</button></td>
		<td><button type="button" onclick="setDefault('time_start')">Set Default</button></td>
	</tr>
	<tr>
		<td>End:</td>
		<td><input type="time" id="time_end"></td>
		<td><button type="button" onclick="fillInCurrentItem('time_end')">Now</button></td>
		<td><button type="button" onclick="setDefault('time_end')">Set Default</button></td>
	</tr>
	<tr>
		<td>Diff:</td>
		<td><div id="time_diff"></div></td>
		<td><button type="button" onclick="calculateDiff()">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<h2>Add/Subtract Value to Time</h2>
<p>Format all value inputs as either "[hours]:[minutes]" (such as 2:10, which represents 2 hours and 10 minutes) or "[hours]" (such as 2.5 or 5, which represents 2.5 hours and 5 hours, respectively).</p>
<div class="allow-overflow">
<table>
	<tr>
		<td>Initial:</td>
		<td><input type="time" id="time_value_initial"></td>
		<td><button type="button" onclick="fillInCurrentItem('time_value_initial')">Now</button></td>
		<td><button type="button" onclick="setDefault('time_value_initial')">Set Default</button></td>
	</tr>
	<tr>
		<td>Action:</td>
		<td><input type="radio" name="action" id="add" checked> Add</td>
	</tr>
	<tr>
		<td></td>
		<td><input type="radio" name="action" id="subtract"> Subtract</td>
	</tr>
	<tr>
		<td>Value:</td>
		<td><input id="time_value_value" value="0:00" size="5"></td>
	</tr>
	<tr>
		<td>Final:</td>
		<td><input type="time" id="time_value_valueDiff" disabled></td>
		<td><button type="button" onclick="calculateValue()">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<h2>Duration in Dates</h2>
<div class="allow-overflow">
<table>
	<tr>
		<td>Start:</td>
		<td><input type="date" id="date_start"></td>
		<td><button type="button" onclick="fillInDate('date_start')">Now</button></td>
	</tr>
	<tr>
		<td>End:</td>
		<td><input type="date" id="date_end"></td>
		<td><button type="button" onclick="fillInDate('date_end')">Now</button></td>
	</tr>
	<tr>
		<td valign="top">Duration:</td>
		<td><div id="date_duration"></div></td>
		<td valign="top"><button type="button" onclick="calculateDuration('date')">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<h2>Duration in Dates/Times</h2>
<div class="allow-overflow">
<table>
	<tr>
		<td>Start:</td>
		<td><input type="datetime-local" id="datetime_start"></td>
		<td><button type="button" onclick="fillInDateTime('datetime_start')">Now</button></td>
	</tr>
	<tr>
		<td>End:</td>
		<td><input type="datetime-local" id="datetime_end"></td>
		<td><button type="button" onclick="fillInDateTime('datetime_end')">Now</button></td>
	</tr>
	<tr>
		<td valign="top">Duration:</td>
		<td><div id="datetime_duration"></div></td>
		<td valign="top"><button type="button" onclick="calculateDuration('datetime')">Calculate</button></td>
	</tr>
</table>
</div>

<hr>

<p>
Not my finest work, but it does work. And it's ultra light-weight. As opposed to <a href="https://www.timeanddate.com/date/timeduration.html">this bloated mess</a> that requires POSTing a request and taking ~9 seconds to load a ~900 KB page on a ~200 Mbps connection.
</p>

<button type="button" onclick="resetSettings()">Reset All Settings</button>

<script>
	checkVersion();

	const elements = ["time_start", "time_end", "time_value_initial"];
	elements.forEach(item => {
		if (localStorage[item] === undefined) {
			document.getElementById(item).value = currentTime();
		} else {
			document.getElementById(item).value = localStorage[item];
		}
	})

	calculateDiff();
</script>
</body>
</html>
